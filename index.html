<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Gen3D - MaÄŸaza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- MODERN PRO TEMASI --- */
        :root { --primary-color: #f76002; --secondary-color: #232f3e; --bg-color: #f8f9fa; --card-radius: 12px; }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--secondary-color); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* GÄ°ZLEME / GÃ–STERME SÄ°STEMÄ° (Sayfa GeÃ§iÅŸleri Ä°Ã§in) */
        .page-view { display: none; padding-bottom: 50px; }
        .page-view.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* NAVBAR & FOOTER (Admin sayfasÄ±nda gizlenecek) */
        .site-header, .site-footer { display: block; }
        .admin-mode .site-header, .admin-mode .site-footer { display: none !important; }
        .admin-mode body { background-color: #e9ecef; }

        .navbar { background-color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .product-card { border: none; border-radius: 12px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: 0.3s; cursor: pointer; height: 100%; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card-img-top { height: 220px; object-fit: cover; border-radius: 12px 12px 0 0; }
        
        .btn-primary-custom { background-color: var(--primary-color); border: none; color: white; border-radius: 8px; padding: 10px 20px; font-weight: 600; width: 100%; transition: 0.2s; }
        .btn-primary-custom:hover { background-color: var(--secondary-color); color: white; }

        /* DETAY SAYFASI Ã–ZEL */
        .detail-container { background: #fff; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-top: 20px; }
        .gallery-thumb { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid #eee; margin-right: 10px; }
        .gallery-thumb.active { border-color: var(--primary-color); }
        
        /* ADMIN PANELÄ° Ã–ZEL */
        .admin-container { max-width: 1000px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* DÄ°ÄžER */
        .cart-badge { background-color: var(--primary-color); color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; position: absolute; top: -5px; right: -5px; }
        .whatsapp-float { position: fixed; bottom: 25px; left: 25px; background-color: #25d366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* Sidebar Filtre */
        .filter-group { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid #eee; }
        .cat-item { cursor: pointer; padding: 5px 0; color: #555; }
        .cat-item:hover, .cat-item.active { color: var(--primary-color); font-weight: bold; }
        
        /* Admin Resim Ã–nizleme */
        .admin-img-preview-item { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; margin-right: 5px; display: inline-block; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top site-header">
        <div class="container">
            <a class="navbar-brand" href="?" onclick="navigateTo('home'); return false;">
                <img src="logo.png" alt="3Gen3D" style="height: 50px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center fw-semibold">
                    <li class="nav-item me-3"><a class="nav-link" href="#" onclick="showInfo('HakkÄ±mÄ±zda', siteSettings.aboutText); return false;">HakkÄ±mÄ±zda</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#" onclick="showInfo('Ä°letiÅŸim', siteSettings.contactText); return false;">Ä°letiÅŸim</a></li>
                    <li class="nav-item position-relative">
                        <a class="nav-link text-primary" href="#" onclick="navigateTo('cart'); return false;">
                            <i class="fas fa-shopping-cart fa-lg"></i> <span class="cart-badge" id="cartCount">0</span> Sepetim
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="view-home" class="page-view active container mt-4">
        <div id="mainHeroCarousel" class="carousel slide mb-5 shadow-sm rounded-3 overflow-hidden" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselInner"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#mainHeroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#mainHeroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
        </div>

        <div class="row">
            <div class="col-lg-3">
                <div class="filter-group">
                    <h6 class="fw-bold mb-3">Kategoriler</h6>
                    <div id="categoryListContainer"></div>
                </div>
                <button class="btn btn-light w-100 border" onclick="renderProducts()">Filtreleri Temizle</button>
            </div>
            
            <div class="col-lg-9">
                <h4 class="fw-bold mb-3" id="listTitle">TÃ¼m ÃœrÃ¼nler</h4>
                <div class="row row-cols-1 row-cols-md-3 g-4" id="productList"></div>
            </div>
        </div>
    </div>

    <div id="view-detail" class="page-view container">
        <button class="btn btn-link text-secondary mb-2 px-0" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> Geri DÃ¶n</button>
        <div class="detail-container">
            <div class="row">
                <div class="col-md-6">
                    <img id="detailImg" src="" class="img-fluid rounded w-100 mb-3 border">
                    <div id="detailGallery" class="d-flex"></div>
                </div>
                <div class="col-md-6">
                    <span class="badge bg-secondary mb-2" id="detailCatBadge">Kategori</span>
                    <h2 class="fw-bold" id="detailTitle">ÃœrÃ¼n AdÄ±</h2>
                    <p class="text-muted small" id="detailModelCode"></p>
                    
                    <h1 class="text-primary fw-bold my-3" id="detailPrice">0 TL</h1>
                    
                    <div class="p-3 bg-light rounded mb-4">
                        <div class="row">
                            <div class="col-6"><strong>Materyal:</strong> <span id="detailMaterial">-</span></div>
                            <div class="col-6"><strong>MenÅŸei:</strong> <span id="detailOrigin">TR</span></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="fw-bold mb-1">Renk SeÃ§:</label>
                        <select class="form-select mb-3" id="detailColorSelect"></select>
                        <label class="fw-bold mb-1">Boyut SeÃ§:</label>
                        <select class="form-select" id="detailSizeSelect"></select>
                    </div>

                    <button class="btn btn-primary-custom btn-lg mb-4" onclick="addToCartFromDetail()">
                        <i class="fas fa-cart-plus me-2"></i> Sepete Ekle
                    </button>

                    <h5 class="fw-bold border-bottom pb-2">ÃœrÃ¼n AÃ§Ä±klamasÄ±</h5>
                    <p class="text-muted" id="detailDesc"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="view-cart" class="page-view container">
        <button class="btn btn-link text-secondary mb-2 px-0" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> AlÄ±ÅŸveriÅŸe DÃ¶n</button>
        <div class="row">
            <div class="col-lg-8">
                <div class="card p-3 mb-3">
                    <h4 class="fw-bold border-bottom pb-3">Sepetim</h4>
                    <div id="cartItemsList"></div>
                    <div id="emptyCartMsg" class="text-center py-5" style="display:none;">Sepetiniz boÅŸ.</div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card p-3 bg-light">
                    <h5 class="fw-bold">SipariÅŸ Ã–zeti</h5>
                    <div class="d-flex justify-content-between fs-4 fw-bold text-primary my-3">
                        <span>Toplam:</span> <span id="cartTotal">0 TL</span>
                    </div>
                    <hr>
                    <h6 class="fw-bold">Teslimat Bilgileri</h6>
                    <input type="text" class="form-control mb-2" id="orderName" placeholder="Ad Soyad" required>
                    <input type="tel" class="form-control mb-2" id="orderPhone" placeholder="Telefon" required>
                    <textarea class="form-control mb-3" id="orderAddress" placeholder="AÃ§Ä±k Adres" rows="3" required></textarea>
                    
                    <button class="btn btn-success w-100 py-3 fw-bold" onclick="checkoutWhatsapp()">
                        <i class="fab fa-whatsapp fa-lg me-2"></i> WhatsApp Ä°le SipariÅŸ Ver
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="page-view container-fluid">
        <div class="admin-container">
            <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
                <h3 class="fw-bold text-danger"><i class="fas fa-cogs"></i> YÃ¶netim Paneli</h3>
                <a href="?" class="btn btn-outline-dark btn-sm">Siteye DÃ¶n</a>
            </div>
            
            <div id="adminLoginScreen">
                <div class="row justify-content-center">
                    <div class="col-md-6 text-center">
                        <p>LÃ¼tfen Master Key girin:</p>
                        <input type="password" id="adminKeyInput" class="form-control mb-3 text-center" placeholder="Åžifre">
                        <button class="btn btn-danger w-100" onclick="verifyAdminKey()">GiriÅŸ Yap</button>
                    </div>
                </div>
            </div>

            <div id="adminContent" style="display:none;">
                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item"><button class="nav-link active" onclick="switchAdminTab('products')">ÃœrÃ¼nler</button></li>
                    <li class="nav-item"><button class="nav-link" onclick="switchAdminTab('banners')">Bannerlar</button></li>
                    <li class="nav-item"><button class="nav-link" onclick="switchAdminTab('settings')">Ayarlar</button></li>
                </ul>

                <div id="tab-products" class="admin-tab-content">
                    <div class="card p-3 mb-3 border-danger">
                        <h5 class="fw-bold">ÃœrÃ¼n Ekle / DÃ¼zenle</h5>
                        <form id="productForm">
                            <input type="hidden" id="editProdId">
                            <div class="row g-2">
                                <div class="col-md-6"><input type="text" class="form-control" id="admName" placeholder="ÃœrÃ¼n AdÄ±" required></div>
                                <div class="col-md-3"><input type="number" class="form-control" id="admPrice" placeholder="Fiyat (TL)" required></div>
                                <div class="col-md-3"><input type="text" class="form-control" id="admCat" placeholder="Kategori"></div>
                                <div class="col-12"><textarea class="form-control" id="admDesc" placeholder="AÃ§Ä±klama"></textarea></div>
                                <div class="col-12">
                                    <label class="btn btn-secondary btn-sm"><i class="fas fa-camera"></i> GÃ¶rsel SeÃ§ <input type="file" hidden id="admImgFile"></label>
                                    <div id="admImgPreview" class="mt-2"></div>
                                </div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-success">Kaydet</button></div>
                            </div>
                        </form>
                    </div>
                    <table class="table table-bordered table-striped">
                        <thead class="table-dark"><tr><th>Resim</th><th>Ad</th><th>Fiyat</th><th>Ä°ÅŸlem</th></tr></thead>
                        <tbody id="adminProductTable"></tbody>
                    </table>
                </div>

                <div id="tab-banners" class="admin-tab-content" style="display:none;">
                    <form id="bannerForm" class="mb-3 p-3 bg-light rounded">
                        <div class="row">
                            <div class="col-md-5"><input type="text" class="form-control" id="banTitle" placeholder="BaÅŸlÄ±k"></div>
                            <div class="col-md-5"><input type="file" class="form-control" id="banFile"></div>
                            <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Ekle</button></div>
                            <input type="hidden" id="banUrl">
                        </div>
                    </form>
                    <ul id="adminBannerList" class="list-group"></ul>
                </div>

                <div id="tab-settings" class="admin-tab-content" style="display:none;">
                     <div class="mb-3"><label>WhatsApp No:</label><input type="text" class="form-control" id="setWhatsapp"></div>
                     <div class="mb-3"><label>HakkÄ±mÄ±zda:</label><textarea class="form-control" id="setAbout"></textarea></div>
                     <button class="btn btn-primary" onclick="saveSettings()">AyarlarÄ± GÃ¼ncelle</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer mt-auto py-4 text-center border-top">
        <div class="container">
            <p class="mb-1 fw-bold text-primary">3Gen3D TasarÄ±m</p>
            <p class="small text-muted mb-3" id="footerContactInfo">...</p>
            <div class="small text-secondary">
                2025 Â© <a href="?page=admin" target="_blank" class="fw-bold text-decoration-none text-secondary">YÃ¶netici GiriÅŸi</a>
            </div>
        </div>
    </footer>

    <a href="#" class="whatsapp-float site-footer" id="whatsappFloat" target="_blank"><i class="fab fa-whatsapp"></i></a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BIN_ID = "6953b479d0ea881f40495ed5"; 
        let API_KEY = "";
        
        // Veriler
        let data = {
            settings: { whatsapp: "905555555555", about: "HakkÄ±mÄ±zda...", contact: "Ä°letiÅŸim..." },
            banners: [{img: "https://via.placeholder.com/1200x400", title: "HoÅŸgeldiniz"}],
            products: [
                { id: 1, name: "Ã–rnek ÃœrÃ¼n", price: 100, category: "Genel", desc: "AÃ§Ä±klama", images: ["https://via.placeholder.com/300"], colors: ["Standart"], sizes: ["Standart"] }
            ]
        };
        
        let cart = [];
        let tempImages = [];

        // --- SAYFA YÃ–NETÄ°MÄ° (ROUTER) ---
        function navigateTo(page, params = {}) {
            // Ã–nce tÃ¼m sayfalarÄ± gizle
            document.querySelectorAll('.page-view').forEach(el => el.classList.remove('active'));
            
            // Ä°stenen sayfayÄ± gÃ¶ster
            const target = document.getElementById(`view-${page}`);
            if(target) target.classList.add('active');
            
            // SayfanÄ±n en Ã¼stÃ¼ne git
            window.scrollTo(0, 0);

            // URL GÃ¼ncelleme (GeÃ§miÅŸe kaydet)
            let url = `?page=${page}`;
            if(params.id) url += `&id=${params.id}`;
            window.history.pushState({page: page, params: params}, '', url);
            
            if(page === 'admin') document.body.classList.add('admin-mode');
            else document.body.classList.remove('admin-mode');
        }

        // TarayÄ±cÄ± Geri TuÅŸu KontrolÃ¼
        window.onpopstate = function(event) {
            if(event.state) {
                // EÄŸer sayfayÄ± kaydettiysek oraya dÃ¶n
                // BasitÃ§e URL'den oku
                const urlParams = new URLSearchParams(window.location.search);
                const page = urlParams.get('page') || 'home';
                
                document.querySelectorAll('.page-view').forEach(el => el.classList.remove('active'));
                document.getElementById(`view-${page}`).classList.add('active');
                
                if(page === 'admin') document.body.classList.add('admin-mode');
                else document.body.classList.remove('admin-mode');
            }
        };

        // --- BAÅžLANGIÃ‡ ---
        document.addEventListener('DOMContentLoaded', async () => {
            await loadFromCloud();
            
            // Hangi sayfadayÄ±z?
            const urlParams = new URLSearchParams(window.location.search);
            const page = urlParams.get('page') || 'home';
            const id = urlParams.get('id');
            
            if(page === 'detail' && id) {
                openProductDetail(parseInt(id));
            } else if (page === 'admin') {
                navigateTo('admin');
            } else if (page === 'cart') {
                navigateTo('cart');
            } else {
                navigateTo('home');
            }
            
            renderHome();
        });

        // --- CLOUD ---
        async function loadFromCloud() {
            try {
                let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
                if(res.ok) {
                    let json = await res.json();
                    if(json.record) data = json.record;
                    renderHome();
                }
            } catch(e) { console.log(e); }
        }

        async function saveToCloud() {
            if(!API_KEY) return alert("Yetki Yok");
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                body: JSON.stringify(data)
            });
            // Sessiz kaydet (UyarÄ± yok)
        }

        // --- EKRAN Ã‡Ä°ZME ---
        function renderHome() {
            // Slider
            const slider = document.getElementById('carouselInner');
            slider.innerHTML = "";
            data.banners.forEach((b, i) => {
                slider.innerHTML += `<div class="carousel-item ${i===0?'active':''}"><img src="${b.img}" class="d-block w-100"></div>`;
            });
            
            // Kategoriler
            const cats = [...new Set(data.products.map(p => p.category))];
            const catDiv = document.getElementById('categoryListContainer');
            catDiv.innerHTML = `<div class="cat-item active" onclick="renderProducts()">TÃ¼mÃ¼</div>`;
            cats.forEach(c => {
                catDiv.innerHTML += `<div class="cat-item" onclick="renderProducts('${c}')">${c}</div>`;
            });

            renderProducts();
            updateFooter();
        }

        function renderProducts(filterCat = null) {
            const list = document.getElementById('productList');
            list.innerHTML = "";
            let items = data.products;
            if(filterCat) items = items.filter(p => p.category === filterCat);
            
            items.forEach(p => {
                list.innerHTML += `
                <div class="col">
                    <div class="product-card p-2" onclick="openProductDetail(${p.id})">
                        <img src="${p.images[0]}" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title text-truncate">${p.name}</h5>
                            <h4 class="text-primary fw-bold">${p.price} TL</h4>
                            <button class="btn btn-primary-custom btn-sm mt-2">Ä°ncele</button>
                        </div>
                    </div>
                </div>`;
            });
            document.getElementById('listTitle').innerText = filterCat ? filterCat : "TÃ¼m ÃœrÃ¼nler";
        }

        // --- DETAY SAYFASI ---
        function openProductDetail(id) {
            const p = data.products.find(x => x.id === id);
            if(!p) return;
            
            document.getElementById('detailTitle').innerText = p.name;
            document.getElementById('detailPrice').innerText = p.price + " TL";
            document.getElementById('detailDesc').innerText = p.desc;
            document.getElementById('detailImg').src = p.images[0];
            document.getElementById('detailCatBadge').innerText = p.category;
            
            // Renk/Boyut
            const cSel = document.getElementById('detailColorSelect');
            const sSel = document.getElementById('detailSizeSelect');
            cSel.innerHTML = ""; sSel.innerHTML = "";
            (p.colors || ["Standart"]).forEach(c => cSel.innerHTML += `<option>${c}</option>`);
            (p.sizes || ["Standart"]).forEach(s => sSel.innerHTML += `<option>${s}</option>`);

            // Galeri
            const gal = document.getElementById('detailGallery');
            gal.innerHTML = "";
            p.images.forEach(img => {
                gal.innerHTML += `<img src="${img}" class="gallery-thumb" onclick="document.getElementById('detailImg').src='${img}'">`;
            });

            // "Mevcut ÃœrÃ¼n ID" bilgisini butona sakla
            document.querySelector('button[onclick="addToCartFromDetail()"]').dataset.id = id;

            // SAYFAYI DEÄžÄ°ÅžTÄ°R (Modal Yok!)
            navigateTo('detail', {id: id});
        }

        function addToCartFromDetail() {
            const id = parseInt(document.querySelector('button[onclick="addToCartFromDetail()"]').dataset.id);
            const p = data.products.find(x => x.id === id);
            const color = document.getElementById('detailColorSelect').value;
            const size = document.getElementById('detailSizeSelect').value;
            
            cart.push({product: p, color, size});
            updateCartCount();
            
            // Direkt sepete gitmek istersen: navigateTo('cart');
            // Ama genelde kullanÄ±cÄ± alÄ±ÅŸveriÅŸe devam etmek ister, o yÃ¼zden sadece sayÄ± artsÄ±n.
        }

        // --- SEPET SAYFASI ---
        function updateCartCount() {
            document.getElementById('cartCount').innerText = cart.length;
        }

        // Sepet sayfasÄ±nÄ± Ã§iz (view-cart aÃ§Ä±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸacak)
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if(mutation.target.id === 'view-cart' && mutation.target.classList.contains('active')) {
                    renderCartPage();
                }
            });
        });
        observer.observe(document.getElementById('view-cart'), { attributes: true });

        function renderCartPage() {
            const list = document.getElementById('cartItemsList');
            list.innerHTML = "";
            let total = 0;
            
            if(cart.length === 0) {
                document.getElementById('emptyCartMsg').style.display = 'block';
            } else {
                document.getElementById('emptyCartMsg').style.display = 'none';
                cart.forEach((item, i) => {
                    total += item.product.price;
                    list.innerHTML += `
                    <div class="d-flex border-bottom py-2">
                        <img src="${item.product.images[0]}" style="width:60px; height:60px; object-fit:cover; border-radius:6px;">
                        <div class="ms-3 flex-grow-1">
                            <h6 class="mb-0 fw-bold">${item.product.name}</h6>
                            <small class="text-muted">${item.color}, ${item.size}</small>
                            <div class="text-primary fw-bold">${item.product.price} TL</div>
                        </div>
                        <button class="btn btn-sm text-danger" onclick="cart.splice(${i},1); renderCartPage(); updateCartCount();"><i class="fas fa-trash"></i></button>
                    </div>`;
                });
            }
            document.getElementById('cartTotal').innerText = total + " TL";
        }

        function checkoutWhatsapp() {
            if(cart.length === 0) return alert("Sepet boÅŸ!");
            const name = document.getElementById('orderName').value;
            const addr = document.getElementById('orderAddress').value;
            if(!name || !addr) return alert("Adres bilgilerini girin.");
            
            let msg = `*SÄ°PARÄ°Åž*\nðŸ‘¤ ${name}\nðŸ“ ${addr}\n\n`;
            let total = 0;
            cart.forEach(c => {
                msg += `ðŸ“¦ ${c.product.name} (${c.color}-${c.size}) - ${c.product.price} TL\n`;
                total += c.product.price;
            });
            msg += `\nðŸ’° *TOPLAM: ${total} TL*`;
            
            window.open(`https://wa.me/${data.settings.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // --- ADMIN ---
        async function verifyAdminKey() {
            const key = document.getElementById('adminKeyInput').value;
            try {
                let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    headers: { 'X-Master-Key': key }
                });
                if(res.ok) {
                    API_KEY = key;
                    document.getElementById('adminLoginScreen').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                    renderAdminProducts();
                    renderAdminBanners();
                    // AyarlarÄ± yÃ¼kle
                    document.getElementById('setWhatsapp').value = data.settings.whatsapp;
                    document.getElementById('setAbout').value = data.settings.about;
                } else { alert("HatalÄ± Åžifre"); }
            } catch(e) { alert("Hata"); }
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab-content').forEach(el => el.style.display = 'none');
            document.getElementById(`tab-${tab}`).style.display = 'block';
        }

        // Admin ÃœrÃ¼nler
        function renderAdminProducts() {
            const t = document.getElementById('adminProductTable');
            t.innerHTML = "";
            data.products.forEach((p, i) => {
                t.innerHTML += `<tr>
                    <td><img src="${p.images[0]}" width="40"></td>
                    <td>${p.name}</td>
                    <td>${p.price}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Sil</button></td>
                </tr>`;
            });
        }
        
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const p = {
                id: Date.now(),
                name: document.getElementById('admName').value,
                price: parseFloat(document.getElementById('admPrice').value),
                category: document.getElementById('admCat').value,
                desc: document.getElementById('admDesc').value,
                images: tempImages.length ? tempImages : ["https://via.placeholder.com/300"],
                colors: ["Standart"], sizes: ["Standart"]
            };
            data.products.push(p);
            saveToCloud(); renderAdminProducts(); this.reset(); tempImages = []; document.getElementById('admImgPreview').innerHTML="";
        });
        
        function deleteProduct(i) {
            if(confirm("Silinecek?")) { data.products.splice(i,1); saveToCloud(); renderAdminProducts(); }
        }

        // ImgBB Entegrasyonu (Admin Ä°Ã§in)
        document.getElementById('admImgFile').addEventListener('change', function() {
            const f = this.files[0];
            if(!f) return;
            const fd = new FormData(); fd.append("image", f);
            fetch(`https://api.imgbb.com/1/upload?key=8a0805cddea15f4c64b848a57d903133`, {method:'POST', body:fd})
            .then(r=>r.json()).then(res => {
                if(res.success) {
                    tempImages.push(res.data.url);
                    document.getElementById('admImgPreview').innerHTML += `<img src="${res.data.url}" width="50" class="me-1">`;
                }
            });
        });
        
        document.getElementById('banFile').addEventListener('change', function() {
            const f = this.files[0];
            if(!f) return;
            const fd = new FormData(); fd.append("image", f);
            fetch(`https://api.imgbb.com/1/upload?key=8a0805cddea15f4c64b848a57d903133`, {method:'POST', body:fd})
            .then(r=>r.json()).then(res => {
                if(res.success) document.getElementById('banUrl').value = res.data.url;
            });
        });

        document.getElementById('bannerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const b = { title: document.getElementById('banTitle').value, img: document.getElementById('banUrl').value };
            if(!b.img) return alert("Resim YÃ¼kleniyor bekleyin...");
            data.banners.push(b);
            saveToCloud(); renderAdminBanners(); this.reset();
        });

        function renderAdminBanners() {
            const l = document.getElementById('adminBannerList');
            l.innerHTML = "";
            data.banners.forEach((b, i) => {
                l.innerHTML += `<li class="list-group-item d-flex justify-content-between"><img src="${b.img}" height="30"> ${b.title} <button class="btn btn-sm btn-danger" onclick="deleteBanner(${i})">X</button></li>`;
            });
        }
        function deleteBanner(i) { data.banners.splice(i,1); saveToCloud(); renderAdminBanners(); }

        function saveSettings() {
            data.settings.whatsapp = document.getElementById('setWhatsapp').value;
            data.settings.about = document.getElementById('setAbout').value;
            saveToCloud();
            updateFooter();
        }

        function updateFooter() {
            document.getElementById('whatsappFloat').href = `https://wa.me/${data.settings.whatsapp}`;
            document.getElementById('footerContactInfo').innerText = data.settings.whatsapp;
        }
        
        function showInfo(t, c) { alert(t + "\n\n" + c); }
    </script>
</body>
</html>
