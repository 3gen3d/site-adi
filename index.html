<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Gen3D - MaÄŸaza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- ORÄ°JÄ°NAL TASARIM (GERÄ° GELDÄ°) --- */
        :root { --primary-color: #f76002; --secondary-color: #232f3e; --bg-color: #f8f9fa; --card-radius: 12px; --whatsapp-color: #25d366; }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--secondary-color); display: flex; flex-direction: column; min-height: 100vh; }
        
        /* GÄ°ZLEME / GÃ–STERME SÄ°STEMÄ° (Popup Yerine Sayfa GeÃ§iÅŸi Ä°Ã§in) */
        .page-section { display: none; animation: fadeIn 0.3s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* NAVBAR & FOOTER */
        .navbar { background-color: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 0.5rem 0; }
        .navbar-brand img { transition: transform 0.3s ease; max-height: 60px; }
        .navbar-brand:hover img { transform: scale(1.05); }
        footer { background-color: #fff; margin-top: auto; border-top: 1px solid #eee; padding: 40px 0 20px 0; text-align: center; }

        /* MANÅžET / SLIDER STÄ°LLERÄ° */
        .carousel-item { height: 400px; background-color: #333; border-radius: 12px; overflow: hidden; position: relative; }
        .carousel-item img { object-fit: cover; height: 100%; width: 100%; opacity: 0.8; }
        .carousel-caption { bottom: 20%; left: 10%; right: 10%; text-align: left; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
        .carousel-caption h2 { font-size: 3rem; font-weight: 800; color: #fff; }

        /* SIDEBAR FÄ°LTRELERÄ° (GERÄ° GELDÄ°) */
        .sidebar-card { background: #fff; border-radius: 8px; border: 1px solid #eee; overflow: hidden; margin-bottom: 15px; }
        .filter-header { padding: 12px 15px; cursor: pointer; font-weight: 700; color: #444; background: #fff; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid transparent; }
        .filter-header:hover { color: var(--primary-color); }
        .filter-body { padding: 15px; background: #fff; display: block; } /* VarsayÄ±lan aÃ§Ä±k */
        
        .cat-list-item { list-style: none; padding: 6px 0; cursor: pointer; color: #555; transition: 0.2s; }
        .cat-list-item:hover, .cat-list-item.active-cat { color: var(--primary-color); font-weight: 600; padding-left: 5px; }

        /* KARTLAR */
        .product-card { border: none; border-radius: var(--card-radius); background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: all 0.3s ease; height: 100%; cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card-img-top { height: 200px; object-fit: cover; border-radius: 12px 12px 0 0; }
        .price-tag { color: var(--primary-color); font-weight: 800; font-size: 1.2rem; }
        
        /* FULL SAYFA DETAY TASARIMI */
        .detail-page-wrapper { background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .gallery-thumb { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; cursor: pointer; border: 2px solid transparent; margin-right: 5px; opacity: 0.7; }
        .gallery-thumb.active { border-color: var(--primary-color); opacity: 1; }
        
        .btn-primary-custom { background-color: var(--primary-color); border: none; color: white; width: 100%; border-radius: 8px; padding: 10px; font-weight: 600; transition:0.2s; }
        .btn-primary-custom:hover { background-color: var(--secondary-color); color: white; }

        .whatsapp-float { position: fixed; bottom: 25px; left: 25px; background-color: var(--whatsapp-color); color: white; width: 55px; height: 55px; border-radius: 50%; text-align: center; font-size: 30px; display: flex; align-items: center; justify-content: center; z-index: 1000; text-decoration: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* ADMIN PANEL Ã–ZEL */
        .admin-layout body { background: #343a40; }
        .admin-container { max-width: 1200px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 10px; min-height: 80vh; }
        
        /* Admin modunda header/footer gizle */
        body.admin-mode .site-header, body.admin-mode .site-footer { display: none !important; }
        body.admin-mode { background-color: #f0f2f5; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top site-header">
        <div class="container">
            <a class="navbar-brand" href="?" onclick="navigateTo('home'); return false;">
                <img src="logo.png" alt="3Gen3D" style="height:50px;">
                <span class="fw-bold ms-2" style="color:var(--secondary-color)">3Gen3D</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 fw-semibold align-items-center">
                    <li class="nav-item me-3"><a class="nav-link" href="#" onclick="alert(siteSettings.aboutText)">HakkÄ±mÄ±zda</a></li>
                    <li class="nav-item me-3"><a class="nav-link" href="#" onclick="alert(siteSettings.contactText)">Ä°letiÅŸim</a></li>
                    <li class="nav-item">
                        <a class="nav-link text-primary" href="#" onclick="navigateTo('cart'); return false;">
                            <i class="fas fa-shopping-cart fa-lg"></i> <span class="badge bg-danger rounded-pill" id="cartCount">0</span> Sepetim
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="page-home" class="page-section active container mt-4">
        <div id="mainHeroCarousel" class="carousel slide mb-5 shadow-sm rounded-3 overflow-hidden" data-bs-ride="carousel">
            <div class="carousel-indicators" id="carouselIndicators"></div>
            <div class="carousel-inner" id="carouselInner"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#mainHeroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#mainHeroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
        </div>

        <div class="row">
            <div class="col-lg-3 mb-4">
                <div class="sidebar-card">
                    <div class="filter-header"><span><i class="fas fa-list-ul me-2"></i> Kategoriler</span></div>
                    <div class="filter-body" id="categoryListContainer"></div>
                </div>
                <div class="sidebar-card">
                    <div class="filter-header"><span><i class="fas fa-coins me-2"></i> Fiyat AralÄ±ÄŸÄ±</span></div>
                    <div class="filter-body">
                        <div class="d-flex align-items-center mb-2">
                            <input type="number" id="minPrice" class="form-control form-control-sm me-1" placeholder="Min">
                            <span class="text-muted">-</span>
                            <input type="number" id="maxPrice" class="form-control form-control-sm ms-1" placeholder="Max">
                        </div>
                        <button class="btn btn-sm btn-primary-custom" onclick="renderProducts()">Uygula</button>
                    </div>
                </div>
                <button class="btn btn-light border w-100 text-muted" onclick="renderProducts()">Filtreleri Temizle</button>
            </div>

            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="fw-bold mb-0" id="listTitle">TÃ¼m ÃœrÃ¼nler</h4>
                    <small class="text-muted"><span id="prodCount">0</span> Ã¼rÃ¼n</small>
                </div>
                <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3" id="productList"></div>
            </div>
        </div>
    </div>

    <div id="page-detail" class="page-section container mt-4">
        <button class="btn btn-link text-secondary mb-3 ps-0" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> MaÄŸazaya DÃ¶n</button>
        <div class="detail-page-wrapper">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <img id="detailImg" src="" class="img-fluid rounded shadow-sm w-100 mb-2 border">
                    <div id="detailGallery" class="d-flex overflow-auto"></div>
                </div>
                <div class="col-md-6">
                    <span id="detailCatBadge" class="badge bg-secondary mb-2"></span>
                    <h2 id="detailTitle" class="fw-bold mb-1">ÃœrÃ¼n AdÄ±</h2>
                    <p class="text-muted small" id="detailModelCode"></p>
                    
                    <h1 id="detailPrice" class="text-primary fw-bold my-3">0 TL</h1>
                    
                    <div class="p-3 bg-light rounded mb-3 small border">
                        <div class="row">
                            <div class="col-6 mb-2"><strong>Materyal:</strong> <span id="detailMaterial">-</span></div>
                            <div class="col-6 mb-2"><strong>MenÅŸei:</strong> <span id="detailOrigin">TR</span></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="fw-bold small mb-1">Renk:</label>
                        <select class="form-select mb-3" id="detailColorSelect"></select>
                        <label class="fw-bold small mb-1">Boyut:</label>
                        <select class="form-select" id="detailSizeSelect"></select>
                    </div>
                    
                    <button class="btn btn-primary-custom btn-lg mb-4" onclick="addToCartFromDetail()">
                        SEPETE EKLE
                    </button>
                    
                    <h6 class="fw-bold border-bottom pb-2">ÃœrÃ¼n AÃ§Ä±klamasÄ±</h6>
                    <p id="detailDesc" class="text-muted small"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-cart" class="page-section container mt-4">
        <button class="btn btn-link text-secondary mb-3 ps-0" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> AlÄ±ÅŸveriÅŸe DÃ¶n</button>
        <div class="row">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm p-3 mb-3">
                    <h4 class="fw-bold mb-3 border-bottom pb-2">Sepetim</h4>
                    <div id="cartList"></div>
                    <div id="emptyCart" class="text-center py-5 text-muted">Sepetiniz boÅŸ.</div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm p-3 bg-light">
                    <h5 class="fw-bold">SipariÅŸ Ã–zeti</h5>
                    <div class="d-flex justify-content-between fs-4 fw-bold text-dark my-3">
                        <span>Toplam:</span> <span id="cartTotal">0 TL</span>
                    </div>
                    <hr>
                    <div class="mb-2"><input type="text" id="ordName" class="form-control" placeholder="Ad Soyad"></div>
                    <div class="mb-2"><input type="tel" id="ordPhone" class="form-control" placeholder="Telefon"></div>
                    <div class="mb-3"><textarea id="ordAddr" class="form-control" placeholder="Adres" rows="3"></textarea></div>
                    <button class="btn btn-success w-100 py-2 fw-bold" onclick="sendOrder()">
                        <i class="fab fa-whatsapp me-1"></i> SÄ°PARÄ°ÅžÄ° TAMAMLA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="page-admin" class="page-section container-fluid">
        <div class="admin-container shadow">
            <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
                <h3 class="fw-bold text-danger"><i class="fas fa-cogs"></i> YÃ¶netim Paneli</h3>
                <a href="?" class="btn btn-outline-dark btn-sm">Siteye DÃ¶n</a>
            </div>

            <div id="adminLogin" class="text-center py-5">
                <h4>GiriÅŸ YapÄ±n</h4>
                <input type="password" id="admKey" class="form-control w-25 mx-auto my-3 text-center" placeholder="Master Key">
                <button class="btn btn-danger" onclick="verifyAdmin()">GiriÅŸ</button>
            </div>

            <div id="adminContent" style="display:none;">
                <ul class="nav nav-tabs mb-3">
                    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabProd">ÃœrÃ¼nler</button></li>
                    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabBan">Banner</button></li>
                    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabSet">Ayarlar</button></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tabProd">
                        <div class="card p-3 mb-3 border-danger">
                            <h6>Yeni ÃœrÃ¼n Ekle</h6>
                            <form id="prodForm" class="row g-2">
                                <div class="col-md-6"><input type="text" id="pName" class="form-control" placeholder="ÃœrÃ¼n AdÄ±" required></div>
                                <div class="col-md-3"><input type="number" id="pPrice" class="form-control" placeholder="Fiyat" required></div>
                                <div class="col-md-3"><select id="pCat" class="form-select"></select></div> <div class="col-12"><textarea id="pDesc" class="form-control" placeholder="AÃ§Ä±klama"></textarea></div>
                                <div class="col-12"><input type="file" id="pImgFile" class="form-control"></div>
                                <div class="col-12 text-end"><button type="submit" class="btn btn-success">Kaydet</button></div>
                            </form>
                        </div>
                        <table class="table table-striped table-hover">
                            <thead class="table-dark"><tr><th>Resim</th><th>Ad</th><th>Fiyat</th><th>Ä°ÅŸlem</th></tr></thead>
                            <tbody id="admProdList"></tbody>
                        </table>
                    </div>

                    <div class="tab-pane fade" id="tabBan">
                         <div class="input-group mb-3">
                             <input type="file" id="bFile" class="form-control">
                             <button class="btn btn-primary" onclick="addBanner()">YÃ¼kle ve Ekle</button>
                         </div>
                         <div id="admBanList"></div>
                    </div>

                    <div class="tab-pane fade" id="tabSet">
                        <div class="mb-3"><label>WhatsApp:</label><input type="text" id="sWa" class="form-control"></div>
                        <div class="mb-3"><label>HakkÄ±mÄ±zda:</label><textarea id="sAbout" class="form-control"></textarea></div>
                        <button class="btn btn-primary" onclick="saveData()">GÃ¼ncelle</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <h5 class="fw-bold" style="color:var(--primary-color)">3Gen3D</h5>
            <p class="text-muted small" id="footerInfo">...</p>
            <div class="small mt-3">
                <a href="?sayfa=admin" target="_blank" class="text-secondary text-decoration-none fw-bold">YÃ¶netici GiriÅŸi</a>
            </div>
        </div>
    </footer>

    <a href="#" class="whatsapp-float site-footer" id="waFloat" target="_blank"><i class="fab fa-whatsapp"></i></a>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BIN_ID = "6953b479d0ea881f40495ed5";
        let API_KEY = "";
        
        // VeritabanÄ±
        let db = {
            settings: { whatsapp: "905000000000", about: "...", contact: "..." },
            banners: [{img: "https://via.placeholder.com/1200x400", title: "HoÅŸgeldiniz"}],
            products: [{id: 1, name: "Ã–rnek ÃœrÃ¼n", price: 100, category: "Genel", desc: "...", images: ["https://via.placeholder.com/300"], colors:["Standart"], sizes:["Standart"]}]
        };
        let cart = [];

        // --- SAYFA YÃ–NETÄ°MÄ° (ROUTER) ---
        function navigateTo(page, params = {}) {
            // Ã–nce hepsini gizle
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            
            // Ä°lgili sayfayÄ± gÃ¶ster
            document.getElementById(`page-${page}`).classList.add('active');
            window.scrollTo(0, 0);

            // URL GÃ¼ncelle
            let url = `?sayfa=${page}`;
            if(params.id) url += `&id=${params.id}`;
            window.history.pushState({page: page, params: params}, '', url);

            // Admin modu kontrolÃ¼ (Header/Footer gizlemek iÃ§in)
            if(page === 'admin') document.body.classList.add('admin-mode');
            else document.body.classList.remove('admin-mode');
        }

        // Geri tuÅŸu kontrolÃ¼
        window.onpopstate = function(e) {
            if(e.state) {
                document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
                document.getElementById(`page-${e.state.page}`).classList.add('active');
                if(e.state.page === 'admin') document.body.classList.add('admin-mode');
                else document.body.classList.remove('admin-mode');
            }
        };

        // --- BAÅžLANGIÃ‡ ---
        document.addEventListener('DOMContentLoaded', async () => {
            await loadData();
            
            const params = new URLSearchParams(window.location.search);
            const page = params.get('sayfa') || 'home';
            const id = params.get('id');

            if(page === 'admin') {
                navigateTo('admin');
            } else if(page === 'detail' && id) {
                openProductDetail(parseInt(id));
            } else if(page === 'cart') {
                navigateTo('cart'); renderCart();
            } else {
                navigateTo('home');
            }
            
            renderHome();
        });

        // --- VERÄ° Ä°ÅžLEMLERÄ° ---
        async function loadData() {
            try {
                let r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`);
                if(r.ok) { let j = await r.json(); if(j.record) db = j.record; }
            } catch(e){}
        }
        async function saveData() {
            if(!API_KEY) return alert("Yetki Yok");
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method:'PUT', headers:{'Content-Type':'application/json','X-Master-Key':API_KEY}, body:JSON.stringify(db) });
            // Sessiz kaydet
        }

        // --- MAÄžAZA FONKSÄ°YONLARI ---
        function renderHome() {
            // Slider
            const car = document.getElementById('carouselInner');
            const ind = document.getElementById('carouselIndicators');
            car.innerHTML = ""; ind.innerHTML = "";
            db.banners.forEach((b,i) => {
                ind.innerHTML += `<button type="button" data-bs-target="#mainHeroCarousel" data-bs-slide-to="${i}" class="${i===0?'active':''}"></button>`;
                car.innerHTML += `<div class="carousel-item ${i===0?'active':''}"><img src="${b.img}" class="d-block w-100"><div class="carousel-caption"><h2>${b.title}</h2></div></div>`;
            });

            // Kategoriler
            const cats = [...new Set(db.products.map(p=>p.category))];
            const cl = document.getElementById('categoryListContainer');
            cl.innerHTML = `<li class="cat-list-item fw-bold text-primary" onclick="renderProducts()">TÃ¼mÃ¼</li>`;
            cats.forEach(c => cl.innerHTML += `<li class="cat-list-item" onclick="renderProducts('${c}')">${c}</li>`);

            renderProducts();
            document.getElementById('waFloat').href = `https://wa.me/${db.settings.whatsapp}`;
            document.getElementById('footerInfo').innerText = db.settings.about.substring(0,50) + "...";
        }

        function renderProducts(catFilter = null) {
            const list = document.getElementById('productList');
            list.innerHTML = "";
            let items = db.products;
            
            // Kategori Filtresi
            if(catFilter) items = items.filter(p => p.category === catFilter);
            
            // Fiyat Filtresi
            const min = parseFloat(document.getElementById('minPrice').value) || 0;
            const max = parseFloat(document.getElementById('maxPrice').value) || Infinity;
            items = items.filter(p => p.price >= min && p.price <= max);

            document.getElementById('listTitle').innerText = catFilter || "TÃ¼m ÃœrÃ¼nler";
            document.getElementById('prodCount').innerText = items.length;

            items.forEach(p => {
                list.innerHTML += `
                <div class="col">
                    <div class="product-card" onclick="openProductDetail(${p.id})">
                        <img src="${p.images[0]}" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title text-truncate">${p.name}</h5>
                            <div class="price-tag">${p.price} TL</div>
                            <button class="btn btn-sm btn-primary-custom mt-2">Ä°ncele</button>
                        </div>
                    </div>
                </div>`;
            });
        }

        // --- DETAY SAYFASI ---
        function openProductDetail(id) {
            const p = db.products.find(x => x.id === id);
            if(!p) return;
            
            // DetaylarÄ± Doldur
            document.getElementById('detailTitle').innerText = p.name;
            document.getElementById('detailPrice').innerText = p.price + " TL";
            document.getElementById('detailDesc').innerText = p.desc;
            document.getElementById('detailImg').src = p.images[0];
            document.getElementById('detailCatBadge').innerText = p.category;
            
            // SeÃ§enekler
            const cs = document.getElementById('detailColorSelect'); cs.innerHTML="";
            (p.colors||['Standart']).forEach(c => cs.innerHTML+=`<option>${c}</option>`);
            const ss = document.getElementById('detailSizeSelect'); ss.innerHTML="";
            (p.sizes||['Standart']).forEach(s => ss.innerHTML+=`<option>${s}</option>`);

            // Galeri
            const gal = document.getElementById('detailGallery'); gal.innerHTML="";
            p.images.forEach(img => gal.innerHTML+=`<img src="${img}" class="gallery-thumb" onclick="document.getElementById('detailImg').src='${img}'">`);

            // ID'yi butona sakla
            document.querySelector('button[onclick="addToCartFromDetail()"]').dataset.id = id;

            // SAYFAYI AÃ‡ (POPUP YOK)
            navigateTo('detail', {id: id});
        }

        function addToCartFromDetail() {
            const id = parseInt(document.querySelector('button[onclick="addToCartFromDetail()"]').dataset.id);
            const p = db.products.find(x => x.id === id);
            cart.push({
                prod: p,
                color: document.getElementById('detailColorSelect').value,
                size: document.getElementById('detailSizeSelect').value
            });
            document.getElementById('cartCount').innerText = cart.length;
            alert("ÃœrÃ¼n Sepete Eklendi");
        }

        // --- SEPET SAYFASI ---
        function renderCart() {
            const l = document.getElementById('cartList'); l.innerHTML = "";
            let t = 0;
            if(cart.length===0) document.getElementById('emptyCart').style.display='block';
            else document.getElementById('emptyCart').style.display='none';

            cart.forEach((c, i) => {
                t += c.prod.price;
                l.innerHTML += `
                <div class="d-flex border-bottom py-2">
                    <img src="${c.prod.images[0]}" style="width:60px; height:60px; object-fit:cover; border-radius:6px;">
                    <div class="ms-3 flex-grow-1">
                        <h6 class="mb-0 fw-bold">${c.prod.name}</h6>
                        <small class="text-muted">${c.color}, ${c.size}</small>
                        <div class="text-primary fw-bold">${c.prod.price} TL</div>
                    </div>
                    <button class="btn btn-sm text-danger" onclick="cart.splice(${i},1); renderCart();"><i class="fas fa-trash"></i></button>
                </div>`;
            });
            document.getElementById('cartTotal').innerText = t + " TL";
            document.getElementById('cartCount').innerText = cart.length;
        }

        function sendOrder() {
            if(cart.length===0) return alert("Sepet boÅŸ");
            const n = document.getElementById('ordName').value;
            const a = document.getElementById('ordAddr').value;
            if(!n || !a) return alert("Bilgileri girin");
            
            let m = `*SÄ°PARÄ°Åž*\nðŸ‘¤ ${n}\nðŸ“ ${a}\n\n`;
            let total = 0;
            cart.forEach(c => { m += `ðŸ“¦ ${c.prod.name} (${c.color}-${c.size}) - ${c.prod.price} TL\n`; total += c.prod.price; });
            m += `\nðŸ’° TOPLAM: ${total} TL`;
            
            window.open(`https://wa.me/${db.settings.whatsapp}?text=${encodeURIComponent(m)}`, '_blank');
        }

        // --- ADMIN ---
        async function verifyAdmin() {
            const k = document.getElementById('admKey').value;
            try {
                let r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {headers:{'X-Master-Key':k}});
                if(r.ok) {
                    API_KEY = k;
                    document.getElementById('adminLogin').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                    renderAdmProd();
                    renderAdmBan();
                    document.getElementById('sWa').value = db.settings.whatsapp;
                    document.getElementById('sAbout').value = db.settings.about;
                    
                    // Kategori Selectini Doldur
                    const cats = [...new Set(db.products.map(p=>p.category)), "Yeni Kategori"];
                    const cs = document.getElementById('pCat'); cs.innerHTML="";
                    cats.forEach(c => cs.innerHTML+=`<option>${c}</option>`);
                } else alert("YanlÄ±ÅŸ Åžifre");
            } catch(e){alert("Hata");}
        }

        function renderAdmProd() {
            const l = document.getElementById('admProdList'); l.innerHTML="";
            db.products.forEach((p,i)=> l.innerHTML+=`<tr><td><img src="${p.images[0]}" width="40"></td><td>${p.name}</td><td>${p.price}</td><td><button class="btn btn-sm btn-danger" onclick="db.products.splice(${i},1); saveData(); renderAdmProd();">Sil</button></td></tr>`);
        }

        // ImgBB Upload
        async function upload(file) {
            const fd = new FormData(); fd.append("image", file);
            let r = await fetch(`https://api.imgbb.com/1/upload?key=8a0805cddea15f4c64b848a57d903133`, {method:'POST', body:fd});
            let j = await r.json(); return j.data.url;
        }

        document.getElementById('prodForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const f = document.getElementById('pImgFile').files[0];
            let url = "https://via.placeholder.com/300";
            if(f) url = await upload(f);
            
            db.products.push({
                id: Date.now(),
                name: document.getElementById('pName').value,
                price: parseFloat(document.getElementById('pPrice').value),
                category: document.getElementById('pCat').value,
                desc: document.getElementById('pDesc').value,
                images: [url], colors: ["Standart"], sizes: ["Standart"]
            });
            saveData(); renderAdmProd(); this.reset();
        });

        async function addBanner() {
            const f = document.getElementById('bFile').files[0];
            if(f) {
                let url = await upload(f);
                db.banners.push({img: url, title: "Banner"});
                saveData(); renderAdmBan();
            }
        }
        function renderAdmBan() {
            const l = document.getElementById('admBanList'); l.innerHTML="";
            db.banners.forEach((b,i)=> l.innerHTML+=`<div class="d-flex justify-content-between border-bottom p-2"><img src="${b.img}" height="40"><button class="btn btn-danger btn-sm" onclick="db.banners.splice(${i},1); saveData(); renderAdmBan()">Sil</button></div>`);
        }
    </script>
</body>
</html>
